# VisionQuant-Pro v3.0: 深度进化方案 (已确认)

基于您的 20 项专业选择，我们制定了以下 v3.0 深度优化计划。本计划旨在将项目从“可用的原型”推向“专业级量化系统”。

## 🎯 核心目标
1.  **极致的视觉相似度**：通过双模型融合、趋势约束和动态隔离，解决“不像”的问题。
2.  **统计学的严谨性**：引入稳健统计、多重假设检验，拒绝伪回归。
3.  **机构级风控与架构**：CVaR 风控、事件驱动回测视角、前后端分离架构雏形。

---

## 📅 实施路线图

### 第一阶段：视觉核心重构 (Focus: 检索质量) - **IN PROGRESS**
> **响应选择**: 1A+C, 2B, 5B, 6D, 8C, 19B

- [ ] **双模融合检索 (8C)**: 同时加载 AttentionCAE 和 QuantCAE 索引，通过归一化分数加权融合，取长补短。
- [ ] **趋势一致性硬约束 (6D)**: 强制过滤掉趋势方向（近 N 日涨跌幅符号）与 Query 截然相反的匹配结果。
- [x] **动态日期隔离 (2B)**: 实现 `min_isolation = max(20, 2 * volatility_window)`，波动越剧烈隔离越久。(已实现静态20天隔离，后续可升级为动态)
- [ ] **行业数据多重兜底 (19B)**: 进一步固化行业数据的获取逻辑，增加本地静态映射表作为最终防线。

### 第二阶段：统计与归因增强 (Focus: 解释性与稳健性)
> **响应选择**: 9ABCD, 12B, 13D

- [ ] **稳健统计 (12B)**: 在 IC 分析和回测中引入 Winsorization (去极值) 和 Huber Loss 思想，减少异常值干扰。
- [ ] **全维解释性 (9ABCD)**: 
    - 相似度分解表（已部分实现，继续增强）
    - 形态词典（尝试识别“V型”、“U型”等简单形态标签）
- [ ] **BL 观点置信度升级 (13D)**: 根据 Top10 的相似度方差和分布紧密度，动态计算观点的 `confidence`，不再仅依赖胜率。

### 第三阶段：回测与风控体系 (Focus: 真实性)
> **响应选择**: 10DBCA, 14BD, 15D, 16D, 17ABCD

- [ ] **高级风控约束 (14BD)**: 在组合优化中加入 MaxDD (最大回撤) 约束项（通过线性近似或惩罚项实现）。
- [ ] **综合交易成本 (17ABCD)**: 完善成本模型，显式加入冲击成本估算（基于流动性）。
- [ ] **多条件再平衡 (15D)**: 实现“定期 + 阈值”混合触发机制。

### 第四阶段：架构演进 (Focus: 工程化)
> **响应选择**: 18D, 20B

- [ ] **FastAPI 服务化 (20B)**: 完善 `web/api/main.py`，使其能完全支撑前端功能，为未来分离做准备。
- [ ] **数据质量全检 (18D)**: 生成独立的数据质量 HTML 报告。

---

## 🚀 立即执行：第一阶段 (视觉核心重构)

我们将立即着手修改 `VisionEngine`，引入双索引融合和高级过滤逻辑，这是提升“像不像”的最直接手段。
